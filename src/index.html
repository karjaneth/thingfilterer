<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js" integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue"></script>

        <script>
            async function get(url, data) {
                return await $.ajax({
                    type: 'GET',
                    url,
                    data,
                    dataType: 'json',
                });
            }

            async function init() {
                window.app = new Vue({
                    el: '#app',

                    data: {
                        query: undefined,
                        countries: undefined,
                        selection: undefined,
                    },

                    methods: {
                        filter: _.throttle(async function(evt) {
                            let query = evt.target.value;
                            console.log('query: ' + query);

                            let countries = await get('/filter', { q: query });

                            // TODO query the api
                            // let countries = [{
                            //     name: 'United States',
                            //     code: 'US',
                            // }, {
                            //     name: 'United Kingdom',
                            //     code: 'GB',
                            // }];
                            this.countries = countries;
                        }, 250),

                        select: function(code) {
                            console.log('code: ' + code);
                            this.selection = code;
                        },
                    },
                });
            }

            $(init);
        </script>
    </head>

    <body>
        <div id="app">
            <input v-on:input="filter" placeholder="Type to filter countries..."/>
            <div id="countries">
                <div v-for="c in countries" v-on:click="select(c.code)">{{ c.name }}</div>
            </div>
        </div>
    </body>
</html>

<!-- plan

as they type into the query input, it will debounce (maybe every 500 ms?) and
query the api for results. those results will be updated on the vue object, and
the page will display the results (maybe up to 10 or so at a time).

-->
