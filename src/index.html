<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <style>
            /* TODO */
        </style>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js" integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue"></script>
        <script>
            'use strict';

            // helper function for API calls
            const get = (url, data) => $.ajax({
                type: 'GET',
                url,
                data,
                dataType: 'json', // data type of API response
            });

            async function init() {
                window.app = new Vue({
                    el: '#app',

                    // define data up front so Vue knows about it
                    data: {
                        query: undefined,
                        countries: undefined,
                        selection: undefined,
                        details: undefined,
                    },

                    // dynamically update our data based on certain bound values
                    watch: {
                        // limit filter API call to once every 1/4 second
                        query: _.throttle(async function(q) {
                            this.countries = await get('/filter', { q });
                        }, 250),

                        selection: async function(s) {
                            this.details = await get(`/details/${s}`);
                        },
                    },
                });
            }

            $(init);
        </script>
    </head>

    <body>
        <div id="app">
            <!-- two-way bind this input to the "query" property -->
            <input v-model="query" placeholder="Type to filter countries..."/>
            <div id="countries">
                <!-- clicking a country name marks it as the "selection" -->
                <div v-for="c in countries" v-on:click="selection = c.code">{{ c.name }}</div>
            </div>
        </div>
    </body>
</html>

<!-- plan

as they type into the query input, it will debounce (maybe every 500 ms?) and
query the api for results. those results will be updated on the vue object, and
the page will display the results (maybe up to 10 or so at a time).

-->
